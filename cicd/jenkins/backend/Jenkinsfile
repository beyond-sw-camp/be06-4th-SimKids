pipeline {
    agent any

    stages {
        stage('Git clone') {
            steps {
                    // git clone
                git branch: 'backend-dev', url: 'https://github.com/beyond-sw-camp/be06-4th-SimKids.git'
            }

        }

        stage('Build') {
            steps {
                // gradlew 권한 부여 및 빌드
                sh '''
                chmod +x backend/gradlew
                cd backend
                ./gradlew bootJar
                '''
            }
        }

        stage('Dockerize') {
            steps {

              script {
                    // DockerFile로 image build
                    sh 'echo build중..'
                    sh 'docker build --tag simkids/backend:1.$BUILD_ID ./cicd/jenkins/backend'

    //                  // Docker 로그인
    //                 withCredentials([usernamePassword(credentialsId: 'docker_credentials', usernameVariable: 'DOCKER_EMAIL', passwordVariable: 'DOCKER_PASSWORD')]) {
    //                     sh "docker login -u ${DOCKER_EMAIL} -p ${DOCKER_PASSWORD}"
    //                 }
    //                 // Docker Push
    //                 sh 'docker push sabujaks/backend:1.$BUILD_ID'
                }

            }
        }
//
//         stage('Send k8s yamls') {
//          // scp 명령어 ->
//
//
//         }
//
//
//         stage('Connect with master') {
//             // ssh 접속
//             // kubectl
//         }
    }
}