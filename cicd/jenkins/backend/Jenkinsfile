pipeline {
    agent any

    stages {
        stage('Git clone') {
            steps {
                    // git clone
                git branch: 'backend-dev', url: 'https://github.com/beyond-sw-camp/be06-4th-SimKids.git'
            }

        }

        stage('Build') {
            steps {
                // gradlew 권한 부여 및 빌드
                sh '''
                chmod +x backend/gradlew
                cd backend
                ./gradlew bootJar
                '''
            }
        }

        stage('Dockerize') {
            steps {

              script {
                    // DockerFile로 image build
                    sh 'echo build..'
                    sh 'docker build --tag simkids/backend:1.$BUILD_ID ./backend'

                    // Docker Login
                    sh 'echo login..'
                    withCredentials([usernamePassword(credentialsId: 'docker-hub-credentials', passwordVariable: 'DOCKER_PASSWORD', usernameVariable: 'DOCKER_USERNAME')]) {
                            sh 'docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD'
                    }

                    // Docker Push
                    sh 'echo docker push..'
                    sh 'docker push simkids/backend:1.$BUILD_ID'
              }
            }
        }
    }
//
//         stage('Send k8s yamls') {
//          // scp 명령어 ->
//
//
//         }
//
//
//         stage('Connect with master') {
//             // ssh 접속
//             // kubectl
//         }

}